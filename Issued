local function copyToClipboard(text)
    -- Try to use the executor's clipboard function
    if writeclipboard then
        writeclipboard(text)
        return true
    elseif setclipboard then
        setclipboard(text)
        return true
    else
        -- Fallback: print and ask user to manually copy
        print("\n=== COPY THE TEXT BELOW ===\n")
        print(text)
        print("\n=== END OF TEXT ===\n")
        return false
    end
end

local function formatItem(item, indent)
    local result = ""
    local prefix = string.rep("  ", indent)
    
    result = result .. prefix .. item.Name .. " [" .. item.ClassName .. "]"
    
    -- Add important properties for certain types
    if item:IsA("RemoteEvent") or item:IsA("RemoteFunction") then
        result = result .. " (Network)"
    elseif item:IsA("ModuleScript") then
        -- Try to get source info if possible
        local success, source = pcall(function() return item.Source:sub(1, 50) end)
        if success then
            result = result .. " -> " .. source:gsub("\n", " "):gsub("\r", "") .. "..."
        end
    elseif item:IsA("Folder") then
        result = result .. "/"
    end
    
    return result
end

local function scanReplicatedStorage()
    local rs = game:GetService("ReplicatedStorage")
    local output = {}
    local itemCount = 0
    
    table.insert(output, "=== REPLICATEDSTORAGE STRUCTURE ===")
    table.insert(output, "Scanned at: " .. os.date("%H:%M:%S"))
    table.insert(output, "")
    
    -- First pass: Get all important items
    local allItems = {}
    
    local function processItem(item, depth)
        itemCount = itemCount + 1
        
        -- Skip certain uninteresting items
        if item:IsA("Sound") or item:IsA("Animation") or item:IsA("Decal") then
            table.insert(allItems, {item = item, depth = depth, type = "asset"})
            return
        end
        
        -- Add this item
        table.insert(allItems, {item = item, depth = depth, type = "important"})
        
        -- Recurse into containers
        if item:IsA("Folder") or item:IsA("Model") or item.Name == "ClientServices" then
            for _, child in pairs(item:GetChildren()) do
                processItem(child, depth + 1)
            end
        end
    end
    
    -- Start scanning
    for _, item in pairs(rs:GetChildren()) do
        processItem(item, 0)
    end
    
    -- Group by type for better organization
    local remoteEvents = {}
    local remoteFunctions = {}
    local moduleScripts = {}
    local folders = {}
    local others = {}
    
    for _, data in pairs(allItems) do
        local item = data.item
        
        if item:IsA("RemoteEvent") then
            table.insert(remoteEvents, data)
        elseif item:IsA("RemoteFunction") then
            table.insert(remoteFunctions, data)
        elseif item:IsA("ModuleScript") then
            table.insert(moduleScripts, data)
        elseif item:IsA("Folder") then
            table.insert(folders, data)
        elseif data.type == "important" then
            table.insert(others, data)
        end
    end
    
    -- Format output by category
    table.insert(output, "=== REMOTE EVENTS ===")
    for _, data in pairs(remoteEvents) do
        table.insert(output, formatItem(data.item, data.depth))
    end
    
    table.insert(output, "")
    table.insert(output, "=== REMOTE FUNCTIONS ===")
    for _, data in pairs(remoteFunctions) do
        table.insert(output, formatItem(data.item, data.depth))
    end
    
    table.insert(output, "")
    table.insert(output, "=== MODULE SCRIPTS ===")
    for _, data in pairs(moduleScripts) do
        table.insert(output, formatItem(data.item, data.depth))
    end
    
    table.insert(output, "")
    table.insert(output, "=== FOLDERS ===")
    for _, data in pairs(folders) do
        table.insert(output, formatItem(data.item, data.depth))
    end
    
    table.insert(output, "")
    table.insert(output, "=== OTHER IMPORTANT ITEMS ===")
    for _, data in pairs(others) do
        table.insert(output, formatItem(data.item, data.depth))
    end
    
    -- Summary
    table.insert(output, "")
    table.insert(output, "=== SUMMARY ===")
    table.insert(output, "Total items scanned: " .. itemCount)
    table.insert(output, "RemoteEvents: " .. #remoteEvents)
    table.insert(output, "RemoteFunctions: " .. #remoteFunctions)
    table.insert(output, "ModuleScripts: " .. #moduleScripts)
    table.insert(output, "Folders: " .. #folders)
    
    -- Convert to string
    local outputText = table.concat(output, "\n")
    
    -- Copy to clipboard
    local success = copyToClipboard(outputText)
    
    if success then
        print("✓ ReplicatedStorage structure copied to clipboard!")
        print("✓ " .. #remoteEvents .. " RemoteEvents")
        print("✓ " .. #remoteFunctions .. " RemoteFunctions") 
        print("✓ " .. #moduleScripts .. " ModuleScripts")
        print("\nPaste it here when you're ready.")
    else
        print("Please copy the printed text above.")
    end
    
    return outputText
end

-- Run the scanner
scanReplicatedStorage()
