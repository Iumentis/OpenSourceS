local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local localPlayer = Players.LocalPlayer

-- =============================================
-- 1. THE VOXEL & RAYCAST SPOOFER
-- =============================================
-- This targets the exact logic in your DrownUtils source
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
local oldIndex = mt.__index
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    -- Hook ReadVoxels: The game uses this to find Water voxels
    if method == "ReadVoxels" and self == workspace.Terrain then
        local material, occupancy = oldNamecall(self, ...)
        
        -- We loop through the returned voxel data and swap Water for Air
        for x = 1, material.Size.X do
            for y = 1, material.Size.Y do
                for z = 1, material.Size.Z do
                    if material[x][y][z] == Enum.Material.Water then
                        material[x][y][z] = Enum.Material.Air
                    end
                end
            end
        end
        return material, occupancy
    end

    -- Hook Raycast: The game uses this as a secondary check
    if method == "Raycast" or method == "FindPartOnRayWithIgnoreList" then
        local result = oldNamecall(self, ...)
        if result and result.Material == Enum.Material.Water then
            -- Tell the game we hit nothing (nil) instead of water
            return nil
        end
    end

    return oldNamecall(self, table.unpack(args))
end)

setreadonly(mt, true)

-- =============================================
-- 2. ATTRIBUTE LOCKER
-- =============================================
-- DrownConsts shows the attribute name is "DrownPercent"
-- We lock this to 0 locally so the UI never shows the blue bar.
RunService.Heartbeat:Connect(function()
    if localPlayer:GetAttribute("DrownPercent") ~= 0 then
        localPlayer:SetAttribute("DrownPercent", 0)
    end
end)

-- =============================================
-- 3. PARTICLE & UI CLEANUP
-- =============================================
-- This stops the "AirBubbles" particles from appearing on your head
local function CleanEffects()
    local char = localPlayer.Character
    if char then
        local head = char:FindFirstChild("Head")
        if head then
            for _, v in pairs(head:GetChildren()) do
                if v.Name == "AirBubbles" then
                    v:Destroy()
                end
            end
        end
    end
    
    local pg = localPlayer:FindFirstChild("PlayerGui")
    if pg then
        local drownGui = pg:FindFirstChild("DrownGui")
        if drownGui then
            drownGui.Enabled = false
        end
    end
end

RunService.RenderStepped:Connect(CleanEffects)

print("--- [BYPASS ACTIVE] DrownUtils Logic Spoofed ---")
