-- Universal Game Structure Scanner
-- Works with ANY executor (even broken ones)

local function safeGetService(name)
    local success, service = pcall(function()
        return game:GetService(name)
    end)
    return success and service or nil
end

local function hasFunction(name)
    return type(_G[name]) == "function" or 
           type(getgenv and getgenv()[name]) == "function"
end

local function tryCopyToClipboard(text)
    -- Try ALL possible clipboard methods
    local methods = {"setclipboard", "toclipboard", "set_clipboard", "clipboard_set"}
    
    for _, methodName in ipairs(methods) do
        local func = _G[methodName] or (getgenv and getgenv()[methodName])
        if type(func) == "function" then
            local success = pcall(func, text)
            if success then
                print("âœ… Copied using " .. methodName)
                return true
            end
        end
    end
    
    -- Try writefile as backup
    if hasFunction("writefile") then
        local success = pcall(writefile, "game_scan.txt", text)
        if success then
            print("âœ… Saved to game_scan.txt")
            return true
        end
    end
    
    return false
end

-- Main scanning function (no classes, just simple functions)
local function scanGameStructure()
    local output = {}
    local maxDepth = 3
    local maxChildren = 30
    
    -- Helper functions
    local function getIcon(className)
        local icons = {
            Folder = "ğŸ“",
            Model = "ğŸ—ï¸",
            Part = "â¬œ",
            MeshPart = "ğŸ”·",
            Script = "ğŸ“œ",
            LocalScript = "ğŸ“œ",
            ModuleScript = "ğŸ“¦",
            RemoteEvent = "ğŸ”—",
            RemoteFunction = "ğŸ”Œ",
            BindableEvent = "ğŸ“¡",
            Tool = "ğŸ› ï¸",
            Player = "ğŸ‘¤",
            Sound = "ğŸ”Š",
        }
        return icons[className] or "â€¢"
    end
    
    local function isImportant(instance)
        local importantTypes = {
            "RemoteEvent", "RemoteFunction", "BindableEvent",
            "Tool", "Model", "Folder",
            "Script", "LocalScript", "ModuleScript",
            "Player"
        }
        
        for _, typeName in ipairs(importantTypes) do
            if instance:IsA(typeName) then
                return true
            end
        end
        
        return false
    end
    
    local function scanChildren(parent, depth, path)
        if depth > maxDepth then return end
        
        local children = parent:GetChildren()
        local count = 0
        
        for _, child in ipairs(children) do
            if count >= maxChildren then
                table.insert(output, string.rep("  ", depth) .. "ğŸ“ ... (" .. (#children - count) .. " more)")
                break
            end
            
            local icon = getIcon(child.ClassName)
            local line = string.rep("  ", depth) .. icon .. " " .. child.Name .. " (" .. child.ClassName .. ")"
            table.insert(output, line)
            
            -- Special handling for important types
            if child:IsA("RemoteEvent") or child:IsA("RemoteFunction") then
                table.insert(output, string.rep("  ", depth+1) .. "ğŸ”— Path: " .. (path or "") .. "." .. child.Name)
            elseif (child:IsA("Folder") or child:IsA("Model")) and depth < maxDepth then
                scanChildren(child, depth + 1, (path or "") .. "." .. child.Name)
            end
            
            count = count + 1
        end
    end
    
    -- Start scanning
    table.insert(output, "=== GAME STRUCTURE SCAN ===")
    table.insert(output, "Time: " .. os.date("%H:%M:%S"))
    table.insert(output, "")
    
    -- Scan core services
    local servicesToScan = {
        "Workspace",
        "Players", 
        "ReplicatedStorage",
        "ReplicatedFirst",
        "Lighting",
        "Teams",
        "SoundService"
    }
    
    for _, serviceName in ipairs(servicesToScan) do
        local service = safeGetService(serviceName)
        if service then
            table.insert(output, "")
            table.insert(output, "ğŸ“¦ " .. serviceName .. ":")
            table.insert(output, string.rep("-", 30))
            
            if serviceName == "Workspace" or serviceName == "Players" or serviceName == "ReplicatedStorage" then
                scanChildren(service, 1, serviceName)
            else
                -- Quick scan for other services
                local children = service:GetChildren()
                local important = 0
                for _, child in ipairs(children) do
                    if isImportant(child) then
                        local icon = getIcon(child.ClassName)
                        table.insert(output, "  " .. icon .. " " .. child.Name .. " (" .. child.ClassName .. ")")
                        important = important + 1
                    end
                end
                table.insert(output, "  Total: " .. #children .. " items, " .. important .. " important")
            end
        end
    end
    
    -- Add player info
    table.insert(output, "")
    table.insert(output, "=== PLAYER INFO ===")
    local players = safeGetService("Players")
    if players then
        local playerList = players:GetPlayers()
        table.insert(output, "Online: " .. #playerList)
        
        local localPlayer = players.LocalPlayer
        if localPlayer then
            table.insert(output, "You: " .. localPlayer.Name)
            if localPlayer.Character then
                table.insert(output, "Character: YES")
                
                -- Check for tools
                local tools = {}
                for _, child in ipairs(localPlayer.Character:GetChildren()) do
                    if child:IsA("Tool") then
                        table.insert(tools, child.Name)
                    end
                end
                
                if #tools > 0 then
                    table.insert(output, "Tools: " .. table.concat(tools, ", "))
                end
            else
                table.insert(output, "Character: NO (dead/respawning)")
            end
        end
    end
    
    -- Add summary
    table.insert(output, "")
    table.insert(output, "=== QUICK STATS ===")
    
    local function countType(serviceName, className)
        local service = safeGetService(serviceName)
        if not service then return 0 end
        
        local count = 0
        for _, child in ipairs(service:GetDescendants()) do
            if child:IsA(className) then
                count = count + 1
            end
        end
        return count
    end
    
    local remoteEvents = countType("ReplicatedStorage", "RemoteEvent") + 
                        countType("Workspace", "RemoteEvent")
    local remoteFunctions = countType("ReplicatedStorage", "RemoteFunction") + 
                           countType("Workspace", "RemoteFunction")
    local tools = countType("Workspace", "Tool")
    
    table.insert(output, "ğŸ”— RemoteEvents: " .. remoteEvents)
    table.insert(output, "ğŸ”Œ RemoteFunctions: " .. remoteFunctions)
    table.insert(output, "ğŸ› ï¸ Tools: " .. tools)
    
    -- Add copy instructions
    table.insert(output, "")
    table.insert(output, "=== TO COPY ===")
    table.insert(output, "1. Select all text above")
    table.insert(output, "2. Copy (Ctrl+C)")
    table.insert(output, "3. Paste it to me!")
    
    return table.concat(output, "\n")
end

-- Main execution
print("ğŸ® Universal Game Scanner")
print("Scanning...")
print("")

local result = scanGameStructure()

-- Display result
print(result)
print("")
print(string.rep("=", 50))

-- Try to copy automatically
local copied = tryCopyToClipboard(result)
if not copied then
    print("âš ï¸  Could not copy automatically")
    print("ğŸ“‹ Please MANUALLY select and copy the text above")
end

print("Lines: " .. select(2, result:gsub("\n", "\n")))
print("Chars: " .. #result)
print(string.rep("=", 50))
