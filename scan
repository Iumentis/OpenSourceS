-- CHECK_RESULTS.lua
print("\n=== HUB ANALYSIS RESULTS ===")

local data = _G.SIMPLE_ANALYSIS_DATA
if not data then
    print("ERROR: No analysis data found!")
    print("Make sure you ran SIMPLE_ANALYSIS.lua first")
    return
end

local total_time = os.clock() - data.start_time
print(string.format("Total monitoring time: %.2f seconds", total_time))

-- 1. Show all captured prints
print("\n[ALL CAPTURED PRINT STATEMENTS]")
if #data.prints > 0 then
    for i, entry in ipairs(data.prints) do
        print(string.format("[%06.3fs] %s", entry.time, entry.message))
    end
else
    print("   (No prints captured - hook may have failed)")
end

-- 2. Show hub-specific prints
print("\n[POTENTIAL HUB SIGNATURES]")
local hub_keywords = {
    "eclipse", "hub", "load", "auth", "check", "key", 
    "main", "init", "inject", "execute", "script"
}

local hub_prints = {}
for _, entry in ipairs(data.prints) do
    local lower_msg = entry.message:lower()
    for _, keyword in ipairs(hub_keywords) do
        if lower_msg:find(keyword) then
            table.insert(hub_prints, {
                time = entry.time,
                message = entry.message,
                keyword = keyword
            })
            break
        end
    end
end

if #hub_prints > 0 then
    for _, entry in ipairs(hub_prints) do
        print(string.format("[%06.3fs] [%s] %s", 
            entry.time, entry.keyword, entry.message))
    end
else
    print("   (No clear hub signatures found in prints)")
end

-- 3. Check for new global variables
print("\n[NEW GLOBAL VARIABLES]")
local current_globals = {}
for k, v in pairs(_G) do
    current_globals[k] = true
end

local new_globals = {}
for k, _ in pairs(current_globals) do
    if not data.initial_globals[k] then
        new_globals[k] = true
    end
end

if next(new_globals) then
    for global_name, _ in pairs(new_globals) do
        print("   _G." .. global_name)
        
        -- Show value if it's a string
        local value = _G[global_name]
        if type(value) == "string" then
            local preview = value
            if #preview > 50 then
                preview = preview:sub(1, 50) .. "..."
            end
            print("      Value: \"" .. preview .. "\"")
        end
    end
else
    print("   (No new global variables)")
end

-- 4. Check shared table
print("\n[NEW SHARED VARIABLES]")
if shared and type(shared) == "table" then
    local new_in_shared = {}
    for k, v in pairs(shared) do
        if not data.initial_shared[k] then
            new_in_shared[k] = true
        end
    end
    
    if next(new_in_shared) then
        for name, _ in pairs(new_in_shared) do
            print("   shared." .. name)
        end
    else
        print("   (No new shared variables)")
    end
end

-- 5. Check new instances
print("\n[NEW INSTANCES CREATED]")
if #data.new_instances > 0 then
    -- Group by class
    local by_class = {}
    for _, inst in ipairs(data.new_instances) do
        by_class[inst.class] = (by_class[inst.class] or 0) + 1
    end
    
    -- Show summary
    for class, count in pairs(by_class) do
        print(string.format("   %s: %d instances", class, count))
    end
    
    -- Show first 3 in detail
    print("\n   First 3 instances:")
    for i = 1, math.min(3, #data.new_instances) do
        local inst = data.new_instances[i]
        print(string.format("   [%06.3fs] %s: %s", 
            inst.time, inst.class, inst.name))
    end
else
    print("   (No new instances detected)")
end

-- 6. Memory usage
local end_memory = game:GetService("Stats"):GetTotalMemoryUsageMb()
local memory_delta = end_memory - data.start_memory
print(string.format("\n[MEMORY USAGE]"))
print(string.format("   Start:  %.2f MB", data.start_memory))
print(string.format("   End:    %.2f MB", end_memory))
print(string.format("   Change: %.2f MB", memory_delta))

-- 7. Look for Eclipse-specific patterns
print("\n[ECLIPSE HUB SPECIFIC CHECKS]")

-- Check for Eclipse UUID pattern
local eclipse_found = false
for k, v in pairs(_G) do
    if type(v) == "string" then
        -- UUID pattern: p95cxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
        if v:match("p95c[0-9a-f]+%-[0-9a-f]+%-[0-9a-f]+%-[0-9a-f]+%-[0-9a-f]+") then
            print("   Found Eclipse UUID pattern in _G." .. k)
            eclipse_found = true
        end
    end
end

-- Check prints for Eclipse messages
for _, entry in ipairs(data.prints) do
    local msg = entry.message
    if msg:find("Eclipse Hub") or msg:find("Eclipse Detector") then
        print(string.format("   Eclipse message found: \"%s\"", msg))
        eclipse_found = true
    end
end

if not eclipse_found then
    print("   (No Eclipse-specific patterns found)")
end

print("\n=== ANALYSIS COMPLETE ===")
