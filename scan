local output = {}

local function add(line)
    table.insert(output, line)
end

-- SAFE scanning function
local function safeScan()
    -- 1. BASIC INFO
    add("=== GAME STRUCTURE - NAMES & PATHS ===")
    add("Time: " .. os.date("%Y-%m-%d %H:%M:%S"))
    add("PlaceId: " .. tostring(game.PlaceId))
    add("")
    
    -- 2. PLAYERS
    add("üéÆ PLAYERS:")
    local success, players = pcall(function() return game:GetService("Players") end)
    if success and players then
        local playerList = {}
        for _, player in pairs(players:GetPlayers()) do
            table.insert(playerList, player.Name)
        end
        add("Online: " .. #playerList .. " - " .. table.concat(playerList, ", "))
        
        local me = players.LocalPlayer
        if me then
            add("You: " .. me.Name)
            
            -- Character tools
            if me.Character then
                local tools = {}
                for _, item in pairs(me.Character:GetChildren()) do
                    if item:IsA("Tool") then
                        table.insert(tools, item.Name)
                    end
                end
                if #tools > 0 then
                    add("Equipped: " .. table.concat(tools, ", "))
                end
            end
            
            -- Backpack tools
            if me.Backpack then
                local backpackTools = {}
                for _, item in pairs(me.Backpack:GetChildren()) do
                    if item:IsA("Tool") then
                        table.insert(backpackTools, item.Name)
                    end
                end
                if #backpackTools > 0 then
                    add("Backpack: " .. table.concat(backpackTools, ", "))
                end
            end
        end
    end
    add("")
    
    -- 3. WORKSPACE (limited)
    add("üèóÔ∏è WORKSPACE ITEMS:")
    local wsSuccess, workspace = pcall(function() return game:GetService("Workspace") end)
    if wsSuccess and workspace then
        local items = workspace:GetChildren()
        add("Total: " .. #items)
        
        -- Show important items only
        for i = 1, math.min(20, #items) do
            local item = items[i]
            if item:IsA("Model") or item:IsA("Tool") or item:IsA("Folder") then
                add("  ‚Ä¢ " .. item.Name .. " (" .. item.ClassName .. ")")
                
                -- Quick peek inside models/tools
                if item:IsA("Tool") then
                    -- Check for remotes in tools
                    for _, child in pairs(item:GetChildren()) do
                        if child:IsA("RemoteEvent") or child:IsA("RemoteFunction") then
                            add("    ‚Ü≥ " .. child.Name .. " (" .. child.ClassName .. ")")
                        end
                    end
                end
            end
        end
        
        if #items > 20 then
            add("  ... and " .. (#items - 20) .. " more items")
        end
    end
    add("")
    
    -- 4. REPLICATEDSTORAGE (MOST IMPORTANT - GET NAMES!)
    add("üì¶ REPLICATEDSTORAGE (ALL ITEMS):")
    local rsSuccess, rs = pcall(function() return game:GetService("ReplicatedStorage") end)
    if rsSuccess and rs then
        local items = rs:GetChildren()
        add("Total items: " .. #items)
        
        -- Group important items
        local modules = {}
        local remotes = {}
        local folders = {}
        
        for _, item in pairs(items) do
            if item:IsA("ModuleScript") then
                table.insert(modules, item.Name)
            elseif item:IsA("RemoteEvent") then
                table.insert(remotes, item.Name .. " (Event)")
            elseif item:IsA("RemoteFunction") then
                table.insert(remotes, item.Name .. " (Function)")
            elseif item:IsA("Folder") then
                table.insert(folders, item.Name)
            end
        end
        
        -- Show modules
        if #modules > 0 then
            add("  üìÑ MODULESCRIPTS (" .. #modules .. "):")
            for _, name in pairs(modules) do
                add("    ‚Ä¢ " .. name)
            end
        end
        
        -- Show remotes
        if #remotes > 0 then
            add("  üîó REMOTES (" .. #remotes .. "):")
            for _, name in pairs(remotes) do
                add("    ‚Ä¢ " .. name)
            end
        end
        
        -- Show folders (peek inside)
        if #folders > 0 then
            add("  üìÅ FOLDERS (" .. #folders .. "):")
            for _, folderName in pairs(folders) do
                local folder = rs:FindFirstChild(folderName)
                if folder then
                    add("    ‚Ä¢ " .. folderName)
                    
                    -- Show important contents
                    local contents = folder:GetChildren()
                    local important = 0
                    for j = 1, math.min(5, #contents) do
                        local content = contents[j]
                        if content:IsA("ModuleScript") or content:IsA("RemoteEvent") then
                            add("      ‚Ü≥ " .. content.Name .. " (" .. content.ClassName .. ")")
                            important = important + 1
                        end
                    end
                    
                    if important == 0 and #contents > 0 then
                        add("      ‚Ü≥ Contains " .. #contents .. " items")
                    end
                end
            end
        end
    end
    add("")
    
    -- 5. REMOTES EVERYWHERE
    add("üîå ALL REMOTES IN GAME:")
    local allRemotes = {}
    local services = {"ReplicatedStorage", "Workspace", "Players", "ReplicatedFirst"}
    
    for _, serviceName in pairs(services) do
        local success, service = pcall(function() return game:GetService(serviceName) end)
        if success and service then
            for _, item in pairs(service:GetDescendants()) do
                if item:IsA("RemoteEvent") then
                    table.insert(allRemotes, serviceName .. "." .. item.Name .. " (Event)")
                elseif item:IsA("RemoteFunction") then
                    table.insert(allRemotes, serviceName .. "." .. item.Name .. " (Function)")
                end
            end
        end
    end
    
    if #allRemotes > 0 then
        for _, remote in pairs(allRemotes) do
            add("  ‚Ä¢ " .. remote)
        end
    else
        add("  No remotes found")
    end
    add("")
    
    -- 6. TOOLS/WEAPONS
    add("üõ†Ô∏è TOOLS & WEAPONS FOUND:")
    local weapons = {}
    
    if wsSuccess and workspace then
        -- Search for tools
        for _, item in pairs(workspace:GetDescendants()) do
            if item:IsA("Tool") then
                table.insert(weapons, item:GetFullName())
                if #weapons >= 10 then break end
            end
        end
    end
    
    if #weapons > 0 then
        for _, weapon in pairs(weapons) do
            add("  ‚Ä¢ " .. weapon)
        end
    else
        add("  No tools found in workspace")
    end
    
    -- Check players for tools
    if success and players then
        for _, player in pairs(players:GetPlayers()) do
            if player.Character then
                for _, item in pairs(player.Character:GetChildren()) do
                    if item:IsA("Tool") then
                        add("  ‚Ä¢ " .. player.Name .. " has: " .. item.Name)
                    end
                end
            end
        end
    end
    
    return table.concat(output, "\n")
end

-- MAIN EXECUTION (SILENT - NO PRINTING UNTIL END)
local fileContent = ""

-- Try to scan safely
local scanSuccess, scanResult = pcall(safeScan)
if scanSuccess then
    fileContent = scanResult
else
    fileContent = "SCAN FAILED: " .. tostring(scanResult)
end

-- TRY TO SAVE TO FILE (SILENTLY)
local saveSuccess = false
local fileName = "game_info_" .. os.time() .. ".txt"

if type(writefile) == "function" then
    local writeSuccess, writeError = pcall(writefile, fileName, fileContent)
    if writeSuccess then
        saveSuccess = true
    end
end

-- NOW print minimal info
print("=" .. string.rep("=", 50))
print("SILENT SCANNER COMPLETE")
print("=" .. string.rep("=", 50))

if saveSuccess then
    print("‚úÖ SAVED TO FILE: " .. fileName)
    
    -- Show preview of what was saved
    print("\nüìÑ FILE PREVIEW (first 20 lines):")
    print(string.rep("-", 50))
    
    local lines = {}
    for line in fileContent:gmatch("[^\r\n]+") do
        table.insert(lines, line)
        if #lines >= 20 then
            table.insert(lines, "... (truncated)")
            break
        end
    end
    print(table.concat(lines, "\n"))
    
else
    print("‚ùå FAILED TO SAVE FILE")
    print("Trying fallback...")
    
    -- Fallback: show minimal info
    print("\nüìã MINIMAL INFO (copy manually):")
    print(string.rep("-", 50))
    print("PlaceId: " .. tostring(game.PlaceId))
    
    local players = game:GetService("Players")
    local me = players.LocalPlayer
    if me then
        print("You: " .. me.Name)
    end
    
    -- Just show module count
    local rs = game:GetService("ReplicatedStorage")
    local modules = 0
    for _, item in pairs(rs:GetChildren()) do
        if item:IsA("ModuleScript") then
            modules = modules + 1
        end
    end
    print("ModuleScripts in ReplicatedStorage: " .. modules)
end

print(string.rep("=", 50))
print("Check your executor's folder for the saved file!")
print("File should contain ALL game structure details.")
